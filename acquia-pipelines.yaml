version: 1.2.0
services:
  - php
variables:
  global:
    ENABLE_FIPS: true
events:
  build:
    steps:
      - welcome:
          script: 
            - kernel=$([ "$(cat /proc/sys/crypto/fips_enabled)" == 1 ] && echo "fips" || echo "non-fips")
            - echo "Kernel is $kernel."
            - openssl_var=$([ "$(cat /proc/sys/crypto/fips_enabled)" == 1 ] && echo "set" || echo "not set")
            - echo "OpenSSL is $openssl_var to 1."
            - openssl md5 ./welcome.txt || echo 'OpenSSL md5 is not supported in FIPS mode.'
            - node -e "require('crypto').createHash('md5').update('')" || echo 'Node md5 is not supported in FIPS mode.' 
            - php -r 'echo md5("foo");' || 'PHP md5 is not working.'
